{
  "hash": "26db678916f55bbe2c60c2973f8f9d86",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Reproducing Shree code - v01\"\ndescription: \"putting together shree messy code\"\nauthor:\n  - name: Renan Monteiro Barbosa\n    url: https://github.com/renanmb\n    affiliation: Master of Data Science Program @ The University of West Florida (UWF)\n    # affiliation-url: https://ucsb-meds.github.io/\n# date: 10-24-2022\ncategories: [code, draft, renan, shree]\n# citation:\n#   url: https://samanthacsik.github.io/posts/2022-10-24-my-blog-post/\nimage: images/spongebob-imagination.jpg\ndraft: false\nbibliography: references.bib\nlink-citations: true\n---\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# options(repos = c(CRAN = \"https://cloud.r-project.org\"))\n\npackages <- c(\"dplyr\", \"car\", \"ResourceSelection\", \"caret\", \"pROC\",  \"logistf\", \"Hmisc\", \"rcompanion\", \"ggplot2\", \"summarytools\", \"tidyverse\", \"knitr\", \"ggpubr\")\n# install.packages(packages)\n\n# Load Libraries\nlapply(packages, library, character.only = TRUE)\n\n# Set seed for reproducibility\nset.seed(123)\n```\n:::\n\n\nLoading Dataset:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nfind_git_root <- function(start = getwd()) {\n  path <- normalizePath(start, winslash = \"/\", mustWork = TRUE)\n  while (path != dirname(path)) {\n    if (dir.exists(file.path(path, \".git\"))) return(path)\n    path <- dirname(path)\n  }\n  stop(\"No .git directory found â€” are you inside a Git repository?\")\n}\n\nrepo_root <- find_git_root()\ndatasets_path <- file.path(repo_root, \"datasets\")\n\n# Reading the datafile healthcare-dataset-stroke-data\nsteve_dataset_path <- file.path(datasets_path, \"kaggle-healthcare-dataset-stroke-data/healthcare-dataset-stroke-data.csv\")\nstroke1 = read_csv(steve_dataset_path, show_col_types = FALSE)\n```\n:::\n\n\nHandling Dataset Features\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nstroke1[stroke1 == \"N/A\" | stroke1 == \"Unknown\" | stroke1 == \"children\" | stroke1 == \"other\"] <- NA\nstroke1$bmi <- round(as.numeric(stroke1$bmi), 2)\nstroke1$gender[stroke1$gender == \"Male\"] <- 1\nstroke1$gender[stroke1$gender == \"Female\"] <- 2\nstroke1$gender <- as.numeric(stroke1$gender)\nstroke1$ever_married[stroke1$ever_married == \"Yes\"] <- 1\nstroke1$ever_married[stroke1$ever_married == \"No\"] <- 2\nstroke1$ever_married <- as.numeric(stroke1$ever_married)\nstroke1$work_type[stroke1$work_type == \"Govt_job\"] <- 1\nstroke1$work_type[stroke1$work_type == \"Private\"] <- 2\nstroke1$work_type[stroke1$work_type == \"Self-employed\"] <- 3\nstroke1$work_type[stroke1$work_type == \"Never_worked\"] <- 4\nstroke1$work_type <- as.numeric(stroke1$work_type)\nstroke1$Residence_type[stroke1$Residence_type == \"Urban\"] <- 1\nstroke1$Residence_type[stroke1$Residence_type == \"Rural\"] <- 2\nstroke1$Residence_type <- as.numeric(stroke1$Residence_type)\nstroke1$avg_glucose_level <- as.numeric(stroke1$avg_glucose_level)\nstroke1$heart_disease <- as.numeric(stroke1$heart_disease)\nstroke1$hypertension <- as.numeric(stroke1$hypertension)\nstroke1$age <- round(as.numeric(stroke1$age), 2)\nstroke1$stroke <- as.numeric(stroke1$stroke)\nstroke1$smoking_status[stroke1$smoking_status == \"never smoked\"] <- 1\nstroke1$smoking_status[stroke1$smoking_status == \"formerly smoked\"] <- 2\nstroke1$smoking_status[stroke1$smoking_status == \"smokes\"] <- 3\nstroke1$smoking_status <- as.numeric(stroke1$smoking_status)\nstroke1 <- stroke1[, !(names(stroke1) %in% \"id\")]\n```\n:::\n\n\nRemoving NAs and cleaning Dataset\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nstroke1$stroke <- as.factor(stroke1$stroke)\nstroke1_clean <- na.omit(stroke1)\nstrokeclean <- stroke1_clean\nfourassume <- stroke1_clean\n```\n:::\n\n\nCode that Shree used\n\n# Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# stroke <- read.csv(\"stroke.csv\") \n# strokeclean\n```\n:::\n\n\n# Elimination of non-predictive identifiers, such as patient ID\n\nCode --\n\n```{{r}}\nstroke = strokeclean %>% select(-id)\nstroke = stroke %>% select(-id) Command\n```\n\n# Making components out of categorical variables (converting into factor)\n\nCode --\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstroke = strokeclean %>%\nmutate(\ngender          = factor(gender),\never_married    = factor(ever_married),\nwork_type       = factor(work_type),\nResidence_type  = factor(Residence_type),\nsmoking_status  = factor(smoking_status),\nhypertension    = factor(hypertension),\nheart_disease   = factor(heart_disease),\nstroke          = factor(stroke, levels = c(0, 1),\nlabels = c(\"No\", \"Yes\"))\n)\n```\n:::\n\n\n## Managing uncommon categories (like the gender group \"Other\")\n\nCode --\n\n::: {.cell}\n\n```{.r .cell-code}\nstroke$gender[stroke$gender == \"Other\"] = \"Male\"\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in `[<-.factor`(`*tmp*`, stroke$gender == \"Other\", value =\nstructure(c(1L, : invalid factor level, NA generated\n```\n\n\n:::\n\n```{.r .cell-code}\nstroke$gender = droplevels(stroke$gender)\n```\n:::\n\n\n \n## Using median imputation to impute missing BMI values\n\nCode- \n\n\n::: {.cell}\n\n```{.r .cell-code}\nstroke$bmi[is.na(stroke$bmi)] = median(stroke$bmi, na.rm = TRUE)\n```\n:::\n\n\n## Convert Bmi into numberic\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstroke$bmi[stroke$bmi == \"N/A\"] = NA\nstroke$bmi = as.numeric(stroke$bmi)\nmedian_bmi = median(stroke$bmi, na.rm = TRUE)\nstroke$bmi[is.na(stroke$bmi)] <- median_bmi\nsummary(stroke$bmi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  11.50   25.40   29.20   30.44   34.20   92.00 \n```\n\n\n:::\n:::\n\n\n## Train/Test division: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nindex = createDataPartition(stroke$stroke, p = 0.7, list = FALSE)\ntrain_data  = stroke[index, ]\ntest_data   = stroke[-index, ]\nprop.table(table(train_data$stroke))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n        No        Yes \n0.94638298 0.05361702 \n```\n\n\n:::\n\n```{.r .cell-code}\nprop.table(table(test_data$stroke))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n        No        Yes \n0.94637537 0.05362463 \n```\n\n\n:::\n:::\n\n\n# 1 Logestic Regression: \n\n```{{r}}\nset.seed(123)\nfit_glm = train(\nmodel_formula,\ndata = train_data,\nmethod = \"glm\",\nfamily = \"binomial\",\ntrControl = ctrl,\nmetric = \"ROC\")\nfit_glm\n```\n\n```{{r}}\nvarImp(fit_glm)\n```\n\n\n# Evaluate model code:\n\n```{{r}}\nevaluate_model = function(model, test_data, positive_class = \"Yes\") {\n```\n\n# Class predictions\n\n\n```{{r}}\npred_class =  predict(model, newdata = test_data)\n```\n\n# Probabilities for positive class \"Yes\"\n\n\n```{{r}}\npred_prob =  predict(model, newdata = test_data, type = \"prob\")[, positive_class]\n```\n\n# Confusion matrix\n\n```{{r}}\ncm =  confusionMatrix(pred_class, test_data$stroke, positive = positive_class)\n```\n\n# ROC & AUC\n\n```{{r}}\n  roc_obj =  roc(\n    response  = test_data$stroke,\n    predictor = pred_prob,\n    levels    = c(\"No\", \"Yes\")  # \"No\" = control, \"Yes\" = case\n  )\n   list(\n    cm      = cm,\n    auc     = auc(roc_obj),\n    roc_obj = roc_obj\n  )\n}\n```\n\n```{{r}}\nres_glm = evaluate_model(fit_glm, test_data)\nres_glm$cm      \nres_glm$auc  \n```\n\n# 2 Decision tree- \n\n```{{r}}\nset.seed(123)\nfit_rpart = train(\nmodel_formula,\n... (191 lines left)\n```\n\n### References\n\n::: {#refs}\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}